<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>智慧式用电安全监管与电能管理平台</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<!-- 引入 Bootstrap -->
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<!-- HTML5 Shiv 和 Respond.js 用于让 IE8 支持 HTML5元素和媒体查询 -->
		<!-- 注意： 如果通过 file://  引入 Respond.js 文件，则该文件无法起效果 -->
		<!--[if lt IE 9]>
         <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
         <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
      <![endif]-->
		<link rel="stylesheet" type="text/css" media="all" href="css/tyle.css">
		<link rel="stylesheet" href="css/animate.css" />
		<link rel="stylesheet" href="css/main.css" />
		<link rel="stylesheet" href="css/index.css" />
	</head>

	<body>
		<div class="home">
			<!--响应式导航-->
			<div class="navbar navbar-default">
				<div class="navbar-header">
					<div class="navLogo">
						<div class="img">
							<img src="images/logo.png" alt="" />
						</div>
						<div class="titleLogo">智慧式用电安全监管与电能管理平台</div>
						<div class="leftSlider fl"></div>
					</div>
					<button class="navbar-toggle" data-toggle="collapse" data-target="#shownav">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				</div>
				<ul id="shownav" class="nav navbar-nav collapse navbar-collapse">
					<li class="iconLi">
						<div class="noiceIcon"></div>
					</li>
					<li>
						<a class="dropdown" data-toggle="dropdown" href="">安云智联
							<span class="caret"></span>
						</a>
						<ul class="dropdown-menu">
							<li>
								<a href="#" class="mainFontColor">管理平台</a>
							</li>
							<li>
								<a href="./record.html" class="mainFontColor">操作日志</a>
							</li>
						</ul>
					</li>
					<li>
						<a href="#" class="mainFontColor">
							<div class="layui-input-inline">
								导出数据
								<div id="inputExport"></div>
							</div>
						</a>
					</li>
					<li>
						<a href="#" class="mainFontColor" data-toggle="modal" data-target="#myModal">修改密码</a>
					</li>
					<li>
						<a href="/login.html" class="mainFontColor">退出</a>
					</li>
				</ul>
			</div>
			<div class="content">
				<div class="slidBox">
					<!--侧边栏-->
					<div class="slidMenuHome">
						<!--城市选择-->
						<div class="citySelect mt15">
							<div class="projectName">
								<span class="fontColor span">城市：</span>
								<input type="text" class="btnInput" style="margin:0;right: 0;top: 0;" id="place" value="全部" />
								<!-- 城市 -->
								<div id="in_city" style="display:none;"></div>
							</div>
						</div>
						<!--echart图表Tab切换-->
						<div class="echartsBox">
							<div class="titleBox">
								<div class="title">
									<div class="bottomLine"></div>
									<div class="activeLine"></div>
									<div class="common tody">今日</div>
									<div class="common tab1">报警占比</div>
									<div class="common tab2">预警占比</div>
									<div class="common all">
										<a href="./allData.html">全部</a>
									</div>
								</div>
								<div class="charts charts1">
									<div id="alarmEchart" style="width:340px;height:242px;"></div>
									<div id="warningEchart" style="width:340px;height:242px;"></div>
								</div>
							</div>
						</div>
						<!--今日昨日数据展示-->
						<div class="number">
							<div class="topNumber clearfix">
								<div class="numberDataBox">
									<div class="dataNumber">1</div>
									<div class="numberTitle">今日报警</div>
								</div>
								<div class="numberDataBox">
									<div class="dataNumber">2</div>
									<div class="numberTitle">昨日报警</div>
								</div>
								<div class="numberDataBox">
									<div class="clearfix">
										<div class="topIcon clearfix">
											<div class="fl dataNumber">100% </div>
											<div class="fl">
												<img src="./images/down.png" alt="" />
											</div>
										</div>
										<div class="numberTitle">同比</div>
									</div>
								</div>
							</div>
							<div class="bottomNumber clearfix">
								<div class="numberDataBox">
									<div class="dataNumber">8</div>
									<div class="numberTitle">今日预警</div>
								</div>
								<div class="numberDataBox">
									<div class="dataNumber">4</div>
									<div class="numberTitle">昨日预警</div>
								</div>
								<div class="numberDataBox">
									<div class="clearfix">
										<div class="topIcon clearfix">
											<div class="fl dataNumber">200% </div>
											<div class="fl">
												<img src="./images/up.png" alt="" />
											</div>
										</div>
										<div class="numberTitle">同比</div>
									</div>
								</div>
							</div>
						</div>
						<!--列表-->
						<div class="project">
							<!--输入框-->
							<div class="projectName" style="position: relative;">
								<span class="fontColor">项目：</span>
								<input type="search" placeholder="搜索项目名称" class="projectNameInput" style="margin:0;right: 0;top: 0;" />
							</div>
							<div class="projectList">
								<ul>
									<li>
										<a href="./projectHome.html">
											<div class="flexDiv pl10">
												<img src="./images/listIcon.png" alt="" />
											</div>
											<div class="flexDiv fontColor">浙江安云智联演示箱</div>
											<div class="flexDiv infoNumber">10</div>
										</a>
									</li>
									<li>
										<a href="./projectHome.html">
											<div class="flexDiv pl10">
												<img src="./images/listIcon.png" alt="" />
											</div>
											<div class="flexDiv fontColor">浙江安云智联演示箱</div>
											<div class="flexDiv infoNumber">1</div>
										</a>
									</li>
									<li>
										<a href="./projectHome.html">
											<div class="flexDiv pl10">
												<img src="./images/listIcon.png" alt="" />
											</div>
											<div class="flexDiv fontColor">浙江安云智联演示箱</div>
										</a>
									</li>
								</ul>
							</div>
						</div>
					</div>
				</div>
				<!--右侧地图-->
				<div class="mapContainer">
					<!--地图-->
					<div id="mapDraw"></div>
					<!--地图上的数据-->
					<!--数据-->
					<div class="positionNumber">
						<div class="numberBox">
							<div class="numberData">32</div>
							<div class="numberTitle">项目总数</div>
						</div>
						<div class="numberBox">
							<div class="numberData">25</div>
							<div class="numberTitle">在线设备</div>
						</div>
						<div class="numberBox">
							<div class="numberData">1</div>
							<div class="numberTitle">报警数</div>
						</div>
						<div class="numberBox">
							<div class="numberData">34</div>
							<div class="numberTitle">预警数</div>
						</div>
					</div>
				</div>
			</div>
			<!--修改密码的弹窗-->
			<div class="eidtPassword">
				<div class="modal passWordModal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal" aria-hidden="true" Onclick='cancle()'>&times;</button>
								<h4 class="modal-title" id="myModalLabel">修改密码</h4>
							</div>
							<div style="padding:0 16px">
								<form name="myForm" action="" method="post">
									<div>
										<label for=""><span class="color66">原密码：</span>
											<input type="text" id="oldPassWorld" name="oldpwd" />
										</label>
										<span id="oldError" class="errorShow"></span>
									</div>
									<div>
										<label for=""><span class="color66">新密码：</span>
											<input type="text" id="newPassWorld" name="newpwd" />
										</label>
										<span id="newError" class="errorShow"></span>
									</div>
								</form>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-default" data-dismiss="modal" Onclick='cancle()'>取消</button>
								<button type="button" Onclick="return validateForm()" class="btn btn-primary">确定</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<script src="js/jquery-3.4.1.min.js"></script>
		<!-- 包括所有已编译的插件 -->
		<script src="js/bootstrap.min.js"></script>
		<!--引入echart-->
		<script src="js/echarts.js"></script>
		<!--日历-->
		<script src="laydate/laydate.js"></script>
		<!--城市插件-->
		<script type="text/javascript" src="js/cityTemplate.js"></script>
		<!--引入高德地图-->
		<script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=67c3e4ff717ee0c352a0ce9ec49991a2"></script>
		<script>
			//控制导航的声音与静音的图标
			//*****************获取侧边栏的高度，并且控制收缩**********************
			var winHeight = $(window).height();
			var mapWidth = document.querySelector('body').clientWidth - 385;
			var height = winHeight;
			$('.home').height(height);
			$('.slidBox').height(height - 60);
			$('.slidMenuHome').height(height - 60);
			$('.mapContainer').height(height - 60);
			$('#mapDraw').height(height - 60);
			$('#mapDraw').width(mapWidth);
			//*****************************点击控制收缩菜单栏*********************
			$('.leftSlider').click(function(){
				if($(this).hasClass("leftSlider")){
					$(this).removeClass('leftSlider');
					$(this).addClass('rightSlider');
//					$('.slidBox').width(0);//修改左侧菜单的宽度	
//					$('#mapDraw').width(document.querySelector('body').clientWidth);//修改地图的宽度
					$('.slidBox').animate({width:'0px'},"slow");
					$('#mapDraw').animate({width:document.querySelector('body').clientWidth+'px'},"slow");
				}else{
					$(this).removeClass('rightSlider');
					$(this).addClass('leftSlider');
//					$('.slidBox').width(385);//修改左侧菜单的宽度	
//					$('#mapDraw').width(mapWidth);//修改地图的宽度
					$('.slidBox').animate({width:'385px'},1000);
					$('#mapDraw').animate({width:(document.querySelector('body').clientWidth-385)+'px'},1000);
				}
			})
			//*****************************点击声音图标改变**********************
			$('.iconLi div').click(function(){
				if($(this).hasClass("noiceIcon")){
					$(this).removeClass('noiceIcon');
					$(this).addClass('noNoiceIcon');
				}else{
					$(this).removeClass('noNoiceIcon');
					$(this).addClass('noiceIcon');
				}
			})
			//*****************************修改密码************************
			function validateForm() {
				var oldPwd = $('#oldPassWorld').val();
				var newPwd = $('#newPassWorld').val()
				if(oldPwd == null || oldPwd == "" || oldPwd == undefined) {
					$('#oldError').show()
					$('#oldError').html('请输入旧密码')
				} else {
					$('#oldError').hide()
				}

				if(newPwd == null || newPwd == "" || newPwd == undefined) {
					$('#newError').show()
					$('#newError').html('请输入新密码')
				} else {
					$('#newError').hide()
				}
			}

			function cancle() {
				$('#oldError').hide()
				$('#newError').hide()
				$('#oldPassWorld').val('')
				$('#newPassWorld').val('')
			}
			//*****************************导出数据************************
			laydate.render({
				elem: '#inputExport',
				range: true
			});
			//*****************************城市选择************************
			var cityA = $(".city_a_le1 a"); //城市
			var pla = $("#place");
			var dest = $("#destination");
			// 默认值
			inCity.width = "382"; //城市选择框  宽
			inCity.height = "auto"; //城市选择框  高
			inCity.id = "#in_city";
			inCity.Children = '.city_a_le1';
			// 初始化 城市HTML模板
			$(inCity.id).prepend(inCity._template.join(''));
			inCity.Hot(cityA);
			//城市 导航
			var apay = $(".screen a");
			var placeThis; //当前选择标签
			apay.click(function(obj) { //城市导航
				inCity.payment($(this));
			})

			inCity.place(pla);
			inCity.cityClick(cityA); //显示赋值城市
			//*****************************图表相关************************
			var alarmEchart = echarts.init(document.getElementById('alarmEchart'));
			var warningEchart = echarts.init(document.getElementById('warningEchart'));
			var option = {
				title: {
					text: ''
				},
				legend: {
					icon: 'stack',
					data: ['短路报警', '漏电报警', '过载报警', '过压报警', '欠压报警', '温度报警', '浪涌报警', '打火报警', '三相报警'],
					top: 25,
					right: 10,
					orient: 'vertical',
					itemGap: 8,
					itemWidth: 20,
					textStyle: {
						color: '#ffffffe6',
						fontWeight: 'normal',
						fontSize: 12
					}
				},
				color: ["#CB3F40", "#F26665", "#F2A5A6", "#B92EE3", "#C077CD", "#D19EDC", "#E79C28", "#F0C647", "#FEE7A2"],
				tooltip: {
					trigger: 'item',
					formatter: "{b}: {c} ({d}%)"
				},
				series: {
					type: 'pie',
					radius: ['65%', '0%'], // 控制大小
					center: ['30%', '54%'], // 控制距离盒子左边上面的距离
					label: {
						normal: {
							show: false
						},
						emphasis: {
							show: false,
							textStyle: {
								fontSize: '14',
								color: '#fff'
							}
						}
					},
					labelLine: {
						normal: {
							show: false
						}
					},
					data: [{
							name: '短路报警',
							value: 20
						},
						{
							name: '漏电报警',
							value: 1
						},
						{
							name: '过载报警',
							value: 150
						},
						{
							name: '过压报警',
							value: 10
						},
						{
							name: '欠压报警',
							value: 3
						},
						{
							name: '温度报警',
							value: 360
						},
						{
							name: '浪涌报警',
							value: 10
						},
						{
							name: '打火报警',
							value: 360
						},
						{
							name: '三相报警',
							value: 10
						}
					]
				}
			};
			var optionWarning = {
				title: {
					text: ''
				},
				legend: {
					icon: 'stack',
					data: ['漏保功能正常', '漏保自检未完成', '漏电预警', '电流预警', '过压预警', '欠压预警', '温度预警', '通讯报警'],
					top: 60,
					right: 5,
					orient: 'vertical',
					itemGap: 8,
					itemWidth: 20,
					textStyle: {
						color: '#ffffffe6',
						fontWeight: 'normal',
						fontSize: 12
					}
				},
				color: ["#CB3F40", "#F26665", "#F2A5A6", "#B92EE3", "#C077CD", "#D19EDC", "#E79C28"],
				tooltip: {
					trigger: 'item',
					formatter: "{b}: {c} ({d}%)"
				},
				series: {
					type: 'pie',
					radius: ['70%', '0%'], // 控制大小
					center: ['30%', '54%'], // 控制距离盒子左边上面的距离
					label: {
						normal: {
							show: false
						},
						emphasis: {
							show: false,
							textStyle: {
								fontSize: '14',
								color: '#fff'
							}
						}
					},
					labelLine: {
						normal: {
							show: false
						}
					},
					data: [{
							name: '漏保功能正常',
							value: 150
						},
						{
							name: '漏保自检未完成',
							value: 20
						},
						{
							name: '漏电预警',
							value: 10
						}, {
							name: '电流预警',
							value: 360
						},
						{
							name: '过压预警',
							value: 10
						},
						{
							name: '欠压预警',
							value: 3
						}, {
							name: '温度预警',
							value: 3
						},
						{
							name: '通讯报警',
							value: 10
						}
					]
				}
			};
			alarmEchart.setOption(option);
			warningEchart.setOption(optionWarning);
			window.addEventListener("resize", () => {
				this.alarmEchart.resize();
				this.warningEchart.resize();
			});
			//饼图echart切换
			$('.tab1').click(function() {
				document.querySelector('.activeLine').style.left = '76px';
				$("#alarmEchart").show();
				$("#warningEchart").hide();
			});
			$('.tab2').click(function() {
				document.querySelector('.activeLine').style.left = '161px';
				$("#alarmEchart").hide();
				$("#warningEchart").show();
			});
			//*****************************地图相关的************************
			var map = new AMap.Map('mapDraw', {
				resizeEnable: true,
				zoom: 7
			});
			var marker;
			var data = [{
				"fLong": 120.208495,
				'fLati': 30.274967,
				'flag': 1
			}, {
				"fLong": 121.144393,
				'fLati': 29.790786,
				'flag': 2
			}, {
				"fLong": 120.750258,
				'fLati': 29.876559,
				'flag': 1
			}];
			var positionMarker = [];
			for(var i = 0; i < data.length; i++) {
//				console.log(data[i]);
				positionMarker = [data[i].fLong, data[i].fLati];
//				console.log(positionMarker);
				var icon;
				if(data[i].flag == 1){
					icon = './images/nomalIcon.png'
				}else if(data[i].flag == 2){
					icon = './images/warnIcon.png'
				}
				marker = new AMap.Marker({
					position: positionMarker,
					icon:icon,
					zIndex: 101,
					map: map
				});
				
				marker.setMap(map);
				marker.on('click', function(e){
					location.href='projectHome.html';
				})
			}
		</script>
	</body>

</html>